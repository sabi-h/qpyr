import pytest

from qpyr._lib.encode import get_best_mode, add_padding, get_best_version


@pytest.mark.parametrize(
    "data,expected_mode", [("1234567890", "numeric"), ("OMEGA", "alphanumeric"), ("help@omegaseed.co.uk", "byte")]
)
def test_get_best_mode(data, expected_mode):
    assert get_best_mode(data) == expected_mode


def test_add_padding():
    data = "0100001000010110111101101101011001010110011101100001011100110110010101100101011001000010110101101101011110010110000101110111011001010111001101101111011011010110010101100110011011110110111101100100011010010110010001100101011000010111001100101101011101110110010101100101011001010000"
    version = 4
    ecl = "H"
    assert (
        add_padding(data, version, ecl)
        == "010000100001011011110110110101100101011001110110000101110011011001010110010101100100001011010110110101111001011000010111011101100101011100110110111101101101011001010110011001101111011011110110010001101001011001000110010101100001011100110010110101110111011001010110010101100101000011101100"
    )


def test_get_best_version():
    data_segment = "0100100001100101011011000110110001101111001011000010000001110111011011110111001001101100011001000010000100100000001100010011001000110011010010000110010101101100011011000110111100101100001000000111011101101111011100100110110001100100001000010010000000110001001100100011001101001000011001010110110001101100011011110010110000100000011101110110111101110010011011000110010000100001001000000011000100110010001100110100100001100101011011000110110001101111001110000011001101101110011001000110010101001000011001010110110001101100011011110010110000100000011101110110111101110010011011000110010000100001001100010011001000110011010010000110010101101100011011000110111100111000001100110110111001100100011001010100100001100101011011000110110001101111001011000010000001110111011011110111001001101100011001000010000100110001001100100011001101001000011001010110110001101100011011110011100000110011011011100110010001100101010010000110010101101100011011000110111100101100001000000111011101101111011100100110110001100100001000010011000100110010001100110100100001100101011011000110110001101111001110000011001101101110011001000110010101001000011001010110110001101100011011110010110000100000011101110110111101110010011011000110010000100001001100010011001000110011010010000110010101101100011011000110111100111000001100110110111001100100011001010100100001100101011011000110110001101111001011000010000001110111011011110111001001101100011001000010000100110001001100100011001101001000011001010110110001101100011011110011100000110011011011100110010001100101010010000110010101101100011011000110111100101100001000000111011101101111011100100110110001100100001000010011000100110010001100110100100001100101011011000110110001101111001110000011001101101110011001000110010101001000011001010110110001101100011011110010110000100000011101110110111101110010011011000110010000100001"
    assert get_best_version(data_segment, mode="byte", ecl="H") == 16
